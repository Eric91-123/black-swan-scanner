<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>é»‘å¤©é¹…è‚¡ç¥¨æ‰«æå™¨ V1</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      background: #f7f8fa;
      padding: 20px;
    }
    h1 { margin-bottom: 10px; }
    button {
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th { background: #f0f2f5; }
    .risk { font-weight: bold; }
  </style>
</head>

<body>

<h1>ğŸ“‰ é»‘å¤©é¹…è‚¡ç¥¨æ‰«æå™¨ï¼ˆV1 Â· Finnhubï¼‰</h1>
<button onclick="loadStocks()">åŠ è½½çœŸå®ç¾è‚¡æ•°æ®</button>

<table id="stockTable">
  <thead>
    <tr>
      <th>ä»£ç </th>
      <th>å…¬å¸</th>
      <th>æœ€æ–°ä»·</th>
      <th>å½“æ—¥æ¶¨è·Œ</th>
      <th>æˆäº¤é‡</th>
      <th>é£é™©çŠ¶æ€</th>
      <th>åˆ†æç»“è®º</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="7">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½æ•°æ®</td>
    </tr>
  </tbody>
</table>

<script>
/** ===== é…ç½®åŒº ===== */
const API_KEY = "d5ljrhhr01qlna889r6gd5ljrhhr01qlna889r70";

const STOCKS = [
  { symbol: "AAPL", name: "Apple" },
  { symbol: "MSFT", name: "Microsoft" },
  { symbol: "TSLA", name: "Tesla" },
  { symbol: "AMZN", name: "Amazon" },
  { symbol: "META", name: "Meta" }
];

/** ===== ä¸»é€»è¾‘ ===== */
async function loadStocks() {
  const tbody = document.querySelector("#stockTable tbody");
  tbody.innerHTML = "";

  for (const stock of STOCKS) {
    try {
      const url = `https://finnhub.io/api/v1/quote?symbol=${stock.symbol}&token=${API_KEY}`;
      const res = await fetch(url);
      const data = await res.json();

      if (!data || data.c === 0) {
        throw new Error("æ— æœ‰æ•ˆæ•°æ®");
      }

      const open = data.o;
      const close = data.c;
      const changePct = ((close - open) / open) * 100;

      let risk = "æ­£å¸¸";
      let conclusion = "æœªå‘ç°æ˜æ˜¾å¼‚å¸¸";

      if (changePct < -8) {
        risk = "âš ï¸ é»‘å¤©é¹…è§‚å¯Ÿ";
        conclusion = "ç–‘ä¼¼çªå‘æ€§ä¸‹è·Œï¼Œå»ºè®®æ ¸æŸ¥æ–°é—» / è´¢æŠ¥ / æ”¿ç­–äº‹ä»¶";
      }

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${stock.symbol}</td>
        <td>${stock.name}</td>
        <td>${close.toFixed(2)}</td>
        <td>${changePct.toFixed(2)}%</td>
        <td>-</td>
        <td class="risk">${risk}</td>
        <td>${conclusion}</td>
      `;
      tbody.appendChild(tr);

      // é˜²æ­¢è§¦å‘å…è´¹ API é¢‘ç‡é™åˆ¶
      await new Promise(r => setTimeout(r, 500));

    } catch (err) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${stock.symbol}</td>
        <td colspan="6">æ•°æ®åŠ è½½å¤±è´¥</td>
      `;
      tbody.appendChild(tr);
    }
  }
}
</script>

</body>
</html>
