<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>é»‘å¤©é¹…è‚¡ç¥¨æ‰«æå™¨ V1</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      background: #f7f8fa;
      padding: 20px;
    }
    h1 { margin-bottom: 10px; }
    button {
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th { background: #f0f2f5; }
    .score { font-weight: bold; }
  </style>
</head>

<body>

<h1>ğŸ“‰ é»‘å¤©é¹…è‚¡ç¥¨æ‰«æå™¨ï¼ˆV1 Â· stooqï¼‰</h1>
<button onclick="loadStocks()">åŠ è½½çœŸå®ç¾è‚¡æ•°æ®</button>

<table id="stockTable">
  <thead>
    <tr>
      <th>ä»£ç </th>
      <th>å…¬å¸</th>
      <th>æœ€æ–°ä»·</th>
      <th>å½“æ—¥æ¶¨è·Œ</th>
      <th>æˆäº¤é‡</th>
      <th>é£é™©çŠ¶æ€</th>
      <th>åˆ†æç»“è®º</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="7">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½æ•°æ®</td>
    </tr>
  </tbody>
</table>

<script>
const SYMBOLS = [
  { symbol: "AAPL.US", name: "Apple" },
  { symbol: "MSFT.US", name: "Microsoft" },
  { symbol: "TSLA.US", name: "Tesla" },
  { symbol: "AMZN.US", name: "Amazon" },
  { symbol: "META.US", name: "Meta" }
];

function stooqUrl(symbol) {
  return `https://stooq.pl/q/l/?s=${symbol}&f=sd2t2ohlcv&h&e=csv`;
}

function corsProxy(url) {
  return `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
}

async function loadStocks() {
  const tbody = document.querySelector("#stockTable tbody");
  tbody.innerHTML = "";

  for (const stock of SYMBOLS) {
    try {
      const res = await fetch(corsProxy(stooqUrl(stock.symbol)));
      const csv = (await res.text()).trim();

      const lines = csv.split("\n").filter(l => l && !l.startsWith("Symbol"));
      if (lines.length === 0) throw new Error("æ— æœ‰æ•ˆè¡Œæƒ…");

      const cols = lines[0].split(",");

      const open  = parseFloat(cols[3]);
      const close = parseFloat(cols[6]);
      const volume = parseFloat(cols[7]);

      if (isNaN(open) || isNaN(close)) {
        throw new Error("ä»·æ ¼ç¼ºå¤±");
      }

      const changePct = ((close - open) / open) * 100;

      let status = "æ­£å¸¸";
      let conclusion = "æœªå‘ç°å¼‚å¸¸";

      if (changePct < -8) {
        status = "âš ï¸ é»‘å¤©é¹…è§‚å¯Ÿ";
        conclusion = "ç–‘ä¼¼çªå‘æ€§é£é™©ï¼Œéœ€äº‹ä»¶å¤ç›˜";
      }

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${stock.symbol.replace(".US","")}</td>
        <td>${stock.name}</td>
        <td>${close.toFixed(2)}</td>
        <td>${changePct.toFixed(2)}%</td>
        <td>${isNaN(volume) ? "-" : volume.toLocaleString()}</td>
        <td class="score">${status}</td>
        <td>${conclusion}</td>
      `;
      tbody.appendChild(tr);

    } catch (err) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${stock.symbol.replace(".US","")}</td>
        <td colspan="6">æ•°æ®åŠ è½½å¤±è´¥</td>
      `;
      tbody.appendChild(tr);
    }
  }
}
</script>

</body>
</html>
