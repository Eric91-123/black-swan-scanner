<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>é»‘å¤©é¹…è‚¡ç¥¨æ‰«æå™¨ V1</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      background: #f7f8fa;
      padding: 20px;
    }
    h1 { margin-bottom: 10px; }
    button {
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      font-size: 14px;
    }
    th { background: #f0f2f5; }
    .risk-high { color: #d4380d; font-weight: bold; }
    .risk-mid { color: #d48806; font-weight: bold; }
    .risk-low { color: #389e0d; font-weight: bold; }
  </style>
</head>

<body>

<h1>ğŸ“‰ é»‘å¤©é¹…è‚¡ç¥¨æ‰«æå™¨ï¼ˆV1 Â· Finnhubï¼‰</h1>
<button onclick="loadStocks()">æ‰«æå¸‚åœºé£é™©</button>

<table id="stockTable">
  <thead>
    <tr>
      <th>ä»£ç </th>
      <th>å…¬å¸</th>
      <th>æœ€æ–°ä»·</th>
      <th>å½“æ—¥æ¶¨è·Œ</th>
      <th>æˆäº¤é‡</th>
      <th>é£é™©ç­‰çº§</th>
      <th>åˆ†æç»“è®º</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="7">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ‰«æ</td>
    </tr>
  </tbody>
</table>

<script>
const API_KEY = "d5ljrhhr01qlna889r6gd5ljrhhr01qlna889r70";

const STOCKS = [
  { symbol: "AAPL", name: "Apple" },
  { symbol: "MSFT", name: "Microsoft" },
  { symbol: "TSLA", name: "Tesla" },
  { symbol: "AMZN", name: "Amazon" },
  { symbol: "META", name: "Meta" }
];

function quoteUrl(symbol) {
  return `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${API_KEY}`;
}

async function loadStocks() {
  const tbody = document.querySelector("#stockTable tbody");
  tbody.innerHTML = "";

  for (const stock of STOCKS) {
    try {
      const res = await fetch(quoteUrl(stock.symbol));
      const data = await res.json();

      const price = typeof data.c === "number" ? data.c : null;
      const changePct = typeof data.dp === "number" ? data.dp : null;
      const volume = typeof data.v === "number" ? data.v : null;

      if (price === null || changePct === null) {
        throw new Error("æ ¸å¿ƒè¡Œæƒ…ç¼ºå¤±");
      }

      /** -------- 1ï¸âƒ£ é£é™©è¯„åˆ†ç³»ç»Ÿ -------- */
      let riskScore = 0;
      if (changePct < -3) riskScore += 1;
      if (changePct < -6) riskScore += 1;
      if (changePct < -9) riskScore += 1;
      if (volume && volume > 50_000_000) riskScore += 1;

      /** -------- 2ï¸âƒ£ é£é™©ç­‰çº§ -------- */
      let riskText = "ä½é£é™©";
      let riskClass = "risk-low";
      let conclusion = "èµ°åŠ¿æ­£å¸¸ï¼Œæœªå‘ç°å¼‚å¸¸";

      if (riskScore >= 3) {
        riskText = "é«˜é£é™©";
        riskClass = "risk-high";
        conclusion = "ç–‘ä¼¼é»‘å¤©é¹…äº‹ä»¶ï¼Œå»ºè®®ç«‹å³å¤ç›˜æ¶ˆæ¯é¢";
      } else if (riskScore === 2) {
        riskText = "ä¸­é£é™©";
        riskClass = "risk-mid";
        conclusion = "å­˜åœ¨å¼‚å¸¸æ³¢åŠ¨ï¼Œéœ€æŒç»­è§‚å¯Ÿ";
      }

      /** -------- 3ï¸âƒ£ æ¸²æŸ“è¡¨æ ¼ -------- */
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${stock.symbol}</td>
        <td>${stock.name}</td>
        <td>${price.toFixed(2)}</td>
        <td>${changePct.toFixed(2)}%</td>
        <td>${volume ? volume.toLocaleString() : "-"}</td>
        <td class="${riskClass}">${riskText}</td>
        <td>${conclusion}</td>
      `;
      tbody.appendChild(tr);

      /** -------- 4ï¸âƒ£ é™é€Ÿä¿æŠ¤ï¼ˆå…³é”®ï¼‰ -------- */
      await new Promise(r => setTimeout(r, 700));

    } catch (err) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${stock.symbol}</td>
        <td colspan="6">æ•°æ®åŠ è½½å¤±è´¥ï¼ˆ${err.message}ï¼‰</td>
      `;
      tbody.appendChild(tr);
    }
  }
}
</script>

</body>
</html>
